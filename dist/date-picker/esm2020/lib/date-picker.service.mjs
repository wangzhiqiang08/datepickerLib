import { Injectable } from '@angular/core';
import * as i0 from "@angular/core";
export class DatePickerService {
    constructor() { }
    calculate(year, month, day) {
        let date = year + '/' + month + '/' + '1';
        console.log(date);
        let whichDay = new Date(date).getDay();
        let message = {
            year: year,
            month: month,
            currentMonthLen: new Date(year, month, 0).getDate(),
            previousMonthLen: new Date(year, (month - 1), 0).getDate(),
            nextMonthLen: new Date(year, (month + 1), 0).getDate(),
            whichDay: whichDay,
            day: day
        };
        return message;
    }
    getTotalMonthList(year, month, day) {
        let dayLists = [];
        let calcResult = this.calculate(year, month, day);
        let startWeekDay = calcResult.whichDay;
        let currentMonthList = this.getMonthList(calcResult.currentMonthLen);
        let previousMonthList = this.getMonthList(calcResult.previousMonthLen);
        let nextMonthList = this.getMonthList(calcResult.nextMonthLen);
        if (startWeekDay == 0) {
            dayLists = [...currentMonthList, ...nextMonthList.slice(0, 42 - currentMonthList.length)];
        }
        else {
            let previousMonthSlice = previousMonthList.slice(-startWeekDay, previousMonthList.length);
            dayLists = [...previousMonthSlice, ...currentMonthList, ...nextMonthList.slice(0, 42 - currentMonthList.length - previousMonthSlice.length)];
        }
        return dayLists;
    }
    getMonthList(monthLength) {
        let list = [];
        for (let i = 1; i <= monthLength; i++) {
            list.push(i);
        }
        return list;
    }
    setEveryDateStatus(year, month, day, selectedDate) {
        let totalDates = this.getTotalMonthList(year, month, day);
        let now = new Date();
        let currentDate = now.getDate();
        let currentMonth = now.getMonth() + 1;
        let currentYear = now.getFullYear();
        let selected = selectedDate && selectedDate.split("/");
        if (!selectedDate) {
            totalDates = totalDates.map((date) => {
                let isToday = (date === currentDate) && (month === currentMonth) && (year === currentYear);
                return { date: date, isToday: isToday, isSelected: false, isCurrentMonth: null };
            });
            totalDates = this.filterAndSetCurrentMonthDate(totalDates);
        }
        else {
            totalDates = totalDates.map((date, index) => {
                let isToday = (date === currentDate) && (month === currentMonth) && (year === currentYear);
                let isSelected = (date === Number(selected[0])) && (month === Number(selected[1])) && (year === Number(selected[2])) && this.isCurrentMontDate(totalDates, index + 1);
                return { date: date, isToday: isToday, isSelected: isSelected, isCurrentMonth: null };
            });
            totalDates = this.filterAndSetCurrentMonthDate(totalDates);
        }
        return totalDates;
    }
    filterAndSetCurrentMonthDate(totalDates) {
        let currentMonthStart, currentMonthEnd, includes = [];
        totalDates.forEach((el, i) => (el.date === 1 || el.date === "1") && includes.push(i));
        if (includes.length > 0) {
            currentMonthStart = includes[0];
            currentMonthEnd = includes[1];
            totalDates.map((date, index) => {
                if (index >= currentMonthStart && index < currentMonthEnd) {
                    date.isCurrentMonth = true;
                }
                else {
                    date.isCurrentMonth = false;
                }
            });
            return totalDates;
        }
        else {
            return totalDates;
        }
    }
    isCurrentMontDate(totalDates, index) {
        let currentMonthStart, currentMonthEnd, includes = [];
        totalDates.forEach((el, i) => (el === 1 || el === "1") && includes.push(i));
        currentMonthStart = includes[0];
        currentMonthEnd = includes[1];
        return index >= currentMonthStart && index < currentMonthEnd;
    }
    getYearList(currentYear) {
        let year = currentYear;
        let endNumber = year.toString().trim().slice(-1);
        let list = [];
        if (endNumber == '0') {
            for (let i = currentYear; i < (currentYear + 10); i++) {
                list.push(Number(i));
            }
        }
        else {
            for (let i = 0; i < 10; i++) {
                currentYear--;
                if (currentYear % 10 == 0) {
                    break;
                }
            }
            for (let i = currentYear; i < (currentYear + 10); i++) {
                list.push(Number(i));
            }
        }
        console.log(list);
        return list;
    }
}
DatePickerService.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.3.9", ngImport: i0, type: DatePickerService, deps: [], target: i0.ɵɵFactoryTarget.Injectable });
DatePickerService.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "13.3.9", ngImport: i0, type: DatePickerService, providedIn: 'root' });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.3.9", ngImport: i0, type: DatePickerService, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root'
                }]
        }], ctorParameters: function () { return []; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0ZS1waWNrZXIuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Byb2plY3RzL2RhdGUtcGlja2VyL3NyYy9saWIvZGF0ZS1waWNrZXIuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDOztBQUszQyxNQUFNLE9BQU8saUJBQWlCO0lBRTVCLGdCQUFnQixDQUFDO0lBRWpCLFNBQVMsQ0FBQyxJQUFZLEVBQUMsS0FBYSxFQUFDLEdBQVc7UUFDOUMsSUFBSSxJQUFJLEdBQUMsSUFBSSxHQUFDLEdBQUcsR0FBQyxLQUFLLEdBQUMsR0FBRyxHQUFDLEdBQUcsQ0FBQztRQUNoQyxPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ2xCLElBQUksUUFBUSxHQUFDLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDO1FBQ3JDLElBQUksT0FBTyxHQUFDO1lBQ04sSUFBSSxFQUFFLElBQUk7WUFDVixLQUFLLEVBQUUsS0FBSztZQUNaLGVBQWUsRUFBRSxJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUMsS0FBSyxFQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sRUFBRTtZQUNqRCxnQkFBZ0IsRUFBRSxJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUMsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLEVBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxFQUFFO1lBQ3hELFlBQVksRUFBRSxJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUMsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLEVBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxFQUFFO1lBQ3BELFFBQVEsRUFBRSxRQUFRO1lBQ2xCLEdBQUcsRUFBRSxHQUFHO1NBQ2IsQ0FBQztRQUNGLE9BQU8sT0FBTyxDQUFDO0lBQ2pCLENBQUM7SUFFRCxpQkFBaUIsQ0FBQyxJQUFZLEVB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QUMsQ0FBQztRQUNqRCxJQUFJLElBQUksR0FBUSxFQUFFLENBQUM7UUFDbkIsSUFBSSxTQUFTLElBQUksR0FBRyxFQUFFO1lBQ3BCLEtBQUssSUFBSSxDQUFDLEdBQUcsV0FBVyxFQUFFLENBQUMsR0FBRyxDQUFDLFdBQVcsR0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRTtnQkFDbkQsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQzthQUN0QjtTQUNGO2FBQU07WUFDTCxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsRUFBRSxFQUFFO2dCQUMzQixXQUFXLEVBQUcsQ0FBQztnQkFDZixJQUFJLFdBQVcsR0FBRyxFQUFFLElBQUksQ0FBQyxFQUFDO29CQUN4QixNQUFNO2lCQUNQO2FBQ0Y7WUFDRCxLQUFLLElBQUksQ0FBQyxHQUFHLFdBQVcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxXQUFXLEdBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUU7Z0JBQ25ELElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7YUFDdEI7U0FDRjtRQUNELE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUE7UUFDakIsT0FBTyxJQUFJLENBQUM7SUFFZCxDQUFDOzs4R0F0SFUsaUJBQWlCO2tIQUFqQixpQkFBaUIsY0FGaEIsTUFBTTsyRkFFUCxpQkFBaUI7a0JBSDdCLFVBQVU7bUJBQUM7b0JBQ1YsVUFBVSxFQUFFLE1BQU07aUJBQ25CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5ASW5qZWN0YWJsZSh7XG4gIHByb3ZpZGVkSW46ICdyb290J1xufSlcbmV4cG9ydCBjbGFzcyBEYXRlUGlja2VyU2VydmljZSB7XG5cbiAgY29uc3RydWN0b3IoKSB7IH1cblxuICBjYWxjdWxhdGUoeWVhcjogbnVtYmVyLG1vbnRoOiBudW1iZXIsZGF5OiBudW1iZXIpOiBhbnkge1xuICAgIGxldCBkYXRlPXllYXIrJy8nK21vbnRoKycvJysnMSc7XG4gICAgY29uc29sZS5sb2coZGF0ZSk7XG4gICAgbGV0IHdoaWNoRGF5PW5ldyBEYXRlKGRhdGUpLmdldERheSgpO1xuICAgIGxldCBtZXNzYWdlPXtcbiAgICAgICAgICB5ZWFyOiB5ZWFyLFxuICAgICAgICAgIG1vbnRoOiBtb250aCxcbiAgICAgICAgICBjdXJyZW50TW9udGhMZW46IG5ldyBEYXRlKHllYXIsbW9udGgsMCkuZ2V0RGF0ZSgpLFxuICAgICAgICAgIHByZXZpb3VzTW9udGhMZW46IG5ldyBEYXRlKHllYXIsKG1vbnRoIC0gMSksMCkuZ2V0RGF0ZSgpLFxuICAgICAgICAgIG5leHRNb250aExlbjogbmV3IERhdGUoeWVhciwobW9udGggKyAxKSwwKS5nZXREYXRlKCksXG4gICAgICAgICAgd2hpY2hEYXk6IHdoaWNoRGF5LFxuICAgICAgICAgIGRheTogZGF5XG4gICAgfTtcbiAgICByZXR1cm4gbWVzc2FnZTtcbiAgfVxuXG4gIGdldFRvdGFsTW9udGhMaXN0KHllYXI6IG51bWJlcixtb250aDogbnVtYmVyLGRheTogbnVtYmVyKTogQXJyYXk8YW55PiB7XG4gICAgbGV0IGRheUxpc3RzOmFueSA9IFtdO1xuICAgIGxldCBjYWxjUmVzdWx0ID0gdGhpcy5jYWxjdWxhdGUoeWVhciwgbW9udGgsIGRheSk7XG4gICAgbGV0IHN0YXJ0V2Vla0RheSA9IGNhbGNSZXN1bHQud2hpY2hEYXk7XG4gICAgbGV0IGN1cnJlbnRNb250aExpc3QgPSB0aGlzLmdldE1vbnRoTGlzdChjYWxjUmVzdWx0LmN1cnJlbnRNb250aExlbik7XG4gICAgbGV0IHByZXZpb3VzTW9udGhMaXN0ID0gdGhpcy5nZXRNb250aExpc3QoY2FsY1Jlc3VsdC5wcmV2aW91c01vbnRoTGVuKTtcbiAgICBsZXQgbmV4dE1vbnRoTGlzdCA9IHRoaXMuZ2V0TW9udGhMaXN0KGNhbGNSZXN1bHQubmV4dE1vbnRoTGVuKTtcblxuICAgIGlmKHN0YXJ0V2Vla0RheSA9PSAwKSB7XG4gICAgICBkYXlMaXN0cyA9IFsuLi5jdXJyZW50TW9udGhMaXN0LCAuLi5uZXh0TW9udGhMaXN0LnNsaWNlKDAsIDQyIC0gY3VycmVudE1vbnRoTGlzdC5sZW5ndGgpXTtcbiAgICB9IGVsc2Uge1xuICAgICAgbGV0IHByZXZpb3VzTW9udGhTbGljZSA9IHByZXZpb3VzTW9udGhMaXN0LnNsaWNlKC1zdGFydFdlZWtEYXksIHByZXZpb3VzTW9udGhMaXN0Lmxlbmd0aCk7XG4gICAgICBkYXlMaXN0cyA9ICBbLi4ucHJldmlvdXNNb250aFNsaWNlLCAuLi5jdXJyZW50TW9udGhMaXN0LCAuLi5uZXh0TW9udGhMaXN0LnNsaWNlKDAsIDQyIC0gY3VycmVudE1vbnRoTGlzdC5sZW5ndGggLSBwcmV2aW91c01vbnRoU2xpY2UubGVuZ3RoKV07XG4gICAgfVxuICAgIHJldHVybiBkYXlMaXN0cztcbiAgfVxuXG4gIGdldE1vbnRoTGlzdChtb250aExlbmd0aDogbnVtYmVyKTogQXJyYXk8YW55PiB7XG4gICAgbGV0IGxpc3Q9W107XG4gICAgZm9yKGxldCBpID0gMTsgaSA8PSBtb250aExlbmd0aDsgaSsrKSB7XG4gICAgICBsaXN0LnB1c2goaSk7XG4gICAgfVxuICAgIHJldHVybiBsaXN0O1xuICB9XG5cbiAgc2V0RXZlcnlEYXRlU3RhdHVzKHllYXI6IG51bWJlcixtb250aDogbnVtYmVyLGRheTogbnVtYmVyLCBzZWxlY3RlZERhdGU6IHN0cmluZyB8IG51bGwpOiBBcnJheTxudW1iZXI+IHtcbiAgICBsZXQgdG90YWxEYXRlczogYW55ID0gdGhpcy5nZXRUb3RhbE1vbnRoTGlzdCh5ZWFyLCBtb250aCwgZGF5KTtcbiAgICBsZXQgbm93ID0gbmV3IERhdGUoKTtcbiAgICBsZXQgY3VycmVudERhdGUgPSBub3cuZ2V0RGF0ZSgpO1xuICAgIGxldCBjdXJyZW50TW9udGggPSBub3cuZ2V0TW9udGgoKSArIDE7XG4gICAgbGV0IGN1cnJlbnRZZWFyID0gbm93LmdldEZ1bGxZZWFyKClcbiAgICBsZXQgc2VsZWN0ZWQ6IGFueSA9IHNlbGVjdGVkRGF0ZSAmJiBzZWxlY3RlZERhdGUuc3BsaXQoXCIvXCIpO1xuICAgIGlmICghc2VsZWN0ZWREYXRlKSB7XG4gICAgICB0b3RhbERhdGVzID0gdG90YWxEYXRlcy5tYXAoKGRhdGU6IGFueSkgPT4ge1xuICAgICAgICBsZXQgaXNUb2RheSA9IChkYXRlID09PSBjdXJyZW50RGF0ZSkgJiYgKG1vbnRoID09PSBjdXJyZW50TW9udGgpICYmICh5ZWFyID09PSBjdXJyZW50WWVhcik7XG4gICAgICAgIHJldHVybiB7ZGF0ZTogZGF0ZSwgaXNUb2RheTogaXNUb2RheSwgaXNTZWxlY3RlZDogZmFsc2UsIGlzQ3VycmVudE1vbnRoOiBudWxsfVxuICAgICAgfSlcbiAgICAgIHRvdGFsRGF0ZXMgPSB0aGlzLmZpbHRlckFuZFNldEN1cnJlbnRNb250aERhdGUodG90YWxEYXRlcyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRvdGFsRGF0ZXMgPSB0b3RhbERhdGVzLm1hcCgoZGF0ZTogYW55LCBpbmRleDogYW55KSA9PiB7XG4gICAgICAgIGxldCBpc1RvZGF5ID0gKGRhdGUgPT09IGN1cnJlbnREYXRlKSAmJiAobW9udGggPT09IGN1cnJlbnRNb250aCkgJiYgKHllYXIgPT09IGN1cnJlbnRZZWFyKTtcbiAgICAgICAgbGV0IGlzU2VsZWN0ZWQgPSAoZGF0ZSA9PT0gTnVtYmVyKHNlbGVjdGVkWzBdKSkgJiYgKG1vbnRoID09PSBOdW1iZXIoc2VsZWN0ZWRbMV0pKSAmJiAoeWVhciA9PT0gTnVtYmVyKHNlbGVjdGVkWzJdKSkgJiYgdGhpcy5pc0N1cnJlbnRNb250RGF0ZSh0b3RhbERhdGVzLCBpbmRleCsxKTtcbiAgICAgICAgcmV0dXJuIHtkYXRlOiBkYXRlLCBpc1RvZGF5OiBpc1RvZGF5LCBpc1NlbGVjdGVkOiBpc1NlbGVjdGVkLCBpc0N1cnJlbnRNb250aDogbnVsbH1cbiAgICAgIH0pXG4gICAgICB0b3RhbERhdGVzID0gdGhpcy5maWx0ZXJBbmRTZXRDdXJyZW50TW9udGhEYXRlKHRvdGFsRGF0ZXMpO1xuICAgIH1cbiAgICByZXR1cm4gdG90YWxEYXRlcztcbiAgfVxuXG4gIGZpbHRlckFuZFNldEN1cnJlbnRNb250aERhdGUodG90YWxEYXRlczogQXJyYXk8bnVtYmVyPikge1xuICAgIGxldCBjdXJyZW50TW9udGhTdGFydDogbnVtYmVyLCBjdXJyZW50TW9udGhFbmQ6IG51bWJlciwgaW5jbHVkZXM6IGFueVtdID0gW107XG4gICAgdG90YWxEYXRlcy5mb3JFYWNoKChlbDphbnksIGk6IGFueSkgPT4gKGVsLmRhdGUgPT09IDEgfHwgZWwuZGF0ZSA9PT0gXCIxXCIpICYmIGluY2x1ZGVzLnB1c2goaSkpO1xuICAgIGlmIChpbmNsdWRlcy5sZW5ndGggPiAwKSB7XG4gICAgICBjdXJyZW50TW9udGhTdGFydCA9IGluY2x1ZGVzWzBdO1xuICAgICAgY3VycmVudE1vbnRoRW5kID0gaW5jbHVkZXNbMV07XG4gICAgICB0b3RhbERhdGVzLm1hcCgoZGF0ZTogYW55LCBpbmRleCkgPT4ge1xuICAgICAgICBpZiAoaW5kZXggPj0gY3VycmVudE1vbnRoU3RhcnQgJiYgaW5kZXggPCBjdXJyZW50TW9udGhFbmQpIHtcbiAgICAgICAgICBkYXRlLmlzQ3VycmVudE1vbnRoID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBkYXRlLmlzQ3VycmVudE1vbnRoID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICByZXR1cm4gdG90YWxEYXRlcztcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHRvdGFsRGF0ZXM7XG4gICAgfVxuICB9XG4gIFxuICBpc0N1cnJlbnRNb250RGF0ZSh0b3RhbERhdGVzOiBBcnJheTxudW1iZXI+LCBpbmRleDogbnVtYmVyKSB7XG4gICAgbGV0IGN1cnJlbnRNb250aFN0YXJ0OiBudW1iZXIsIGN1cnJlbnRNb250aEVuZDogbnVtYmVyLCBpbmNsdWRlczogYW55W10gPSBbXTtcbiAgICB0b3RhbERhdGVzLmZvckVhY2goKGVsOmFueSwgaTogYW55KSA9PiAoZWwgPT09IDEgfHwgZWwgPT09IFwiMVwiKSAmJiBpbmNsdWRlcy5wdXNoKGkpKTtcbiAgICBjdXJyZW50TW9udGhTdGFydCA9IGluY2x1ZGVzWzBdO1xuICAgIGN1cnJlbnRNb250aEVuZCA9IGluY2x1ZGVzWzFdO1xuICAgIHJldHVybiBpbmRleCA+PSBjdXJyZW50TW9udGhTdGFydCAmJiBpbmRleCA8IGN1cnJlbnRNb250aEVuZDtcbiAgfVxuXG4gIGdldFllYXJMaXN0KGN1cnJlbnRZZWFyOiBudW1iZXIpIHtcbiAgICBsZXQgeWVhciA9IGN1cnJlbnRZZWFyO1xuICAgIGxldCBlbmROdW1iZXIgPSB5ZWFyLnRvU3RyaW5nKCkudHJpbSgpLnNsaWNlKC0xKTtcbiAgICBsZXQgbGlzdDogYW55ID0gW107XG4gICAgaWYgKGVuZE51bWJlciA9PSAnMCcpIHtcbiAgICAgIGZvciAobGV0IGkgPSBjdXJyZW50WWVhcjsgaSA8IChjdXJyZW50WWVhcisxMCk7IGkrKykge1xuICAgICAgICBsaXN0LnB1c2goTnVtYmVyKGkpKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDsgaSsrKSB7XG4gICAgICAgIGN1cnJlbnRZZWFyIC0tO1xuICAgICAgICBpZiAoY3VycmVudFllYXIgJSAxMCA9PSAwKXtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZm9yIChsZXQgaSA9IGN1cnJlbnRZZWFyOyBpIDwgKGN1cnJlbnRZZWFyKzEwKTsgaSsrKSB7XG4gICAgICAgIGxpc3QucHVzaChOdW1iZXIoaSkpO1xuICAgICAgfVxuICAgIH1cbiAgICBjb25zb2xlLmxvZyhsaXN0KVxuICAgIHJldHVybiBsaXN0O1xuICAgIFxuICB9XG59XG4iXX0=